{% load static %}

<!DOCTYPE html>
<html lang="pt-BR" x-data="{ menuOpen: false }">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Sales APP{% endblock %}</title>

    <link rel="stylesheet" href="{% static "dist/css/default.css" %}">

    <!-- HTMX -->
    <script src="https://unpkg.com/htmx.org@2.0.3"></script>

    <!-- Alpine.js -->
    <script src="https://unpkg.com/alpinejs@3.14.1" defer></script>

    {# Material Icons #}
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,300,0,0" />

    {% block head %}{% endblock %}
</head>

<body class="bg-gray-100 text-gray-900 min-h-screen flex flex-col lg:flex-row">

<div class="drawer lg:drawer-open">
    <input id="my-drawer-2" type="checkbox" class="drawer-toggle" />
    <div class="drawer-content flex flex-col">
        <nav class="flex items-center p-4 w-full bg-white shadow justify-between">
            <div class="flex items-center gap-2">
                <h1 class="hidden lg:block">
                    {% block page_title %}Title{% endblock %}
                </h1>
            </div>
            <div class="flex items-center gap-1 lg:hidden">
                <a class="btn btn-sm  btn-ghost" href="{% url 'sales:home' %}">
                    <span class="material-symbols-outlined">
                        home
                    </span>
                </a>
                <a class="btn btn-sm  btn-ghost" href="{% url 'sales:products' %}">
                    <span class="material-symbols-outlined">
                        Package
                    </span>
                    Products
                </a>
                <a  class="btn btn-sm  btn-ghost"href="{% url 'sales:order_history' %}">
                    <span class="material-symbols-outlined">
                        history
                    </span>
                    Orders
                </a>
            </div>
            <div class="flex items-center">
                <a class="btn btn-sm  btn-ghost" href="{% url 'sales:review' %}">
                    <span class="material-symbols-outlined">
                        shopping_cart
                    </span>
                    <span class="hidden lg:block">Order items in Cart</span>
                    <span class="badge badge-sm badge-error text-white">
                        <span id="item_count_badge">
                            {{ cart_item_count|default:"0" }}
                        </span>
                    </span>
                </a>
            </div>
        </nav>

        <div class="flex-1 p-4">
            {% block content %}{% endblock %}
        </div>

    </div>
    <div class="drawer-side bg-white border-r hidden lg:block">
        <label for="my-drawer-2" aria-label="close sidebar" class="drawer-overlay"></label>

        <div class="flex gap-2 items-center px-6" style="height: 64px">
            <img src="{% static 'images/logo.png' %}" alt="Logo" class="w-12 h-12" />
            <h1 class="font-bold text-lg">
                Sales App
            </h1>
        </div>

        <ul class="menu text-base-content w-80 p-4">
            <!-- Sidebar content here -->
            <li>
                <a href="{% url 'sales:home' %}">
                    <span class="material-symbols-outlined">
                        home
                    </span>
                    <span>Home</span>
                </a>
            </li>
            <li>
                <a href="{% url 'sales:products' %}">
                    <span class="material-symbols-outlined">
                        Package
                    </span>
                    <span>Products</span>
                </a>
            </li>
            <li>
                <a href="{% url 'sales:order_history' %}">
                    <span class="material-symbols-outlined">
                        history
                    </span>
                    <span>Sales History</span>
                </a>
            </li>
        </ul>
    </div>
</div>

<script>
// Handle HTMX events for modal
document.body.addEventListener('htmx:afterSwap', function(event) {
    // Check if the swapped content is a modal
    const modal = event.detail.target.querySelector('#product_detail_modal');
    if (modal) {
        // Close any existing modal first
        const existingModal = document.getElementById('product_detail_modal');
        if (existingModal && existingModal !== modal) {
            existingModal.close();
            existingModal.remove();
        }
        // Show the new modal
        modal.showModal();
        
        // Clean up on close
        modal.addEventListener('close', function() {
            const self = this;
            setTimeout(() => {
                if (self.parentNode) {
                    self.remove();
                }
            }, 150);
        }, { once: true });
    }
});

// Also handle modals swapped directly into body
document.body.addEventListener('htmx:afterSwap', function(event) {
    if (event.detail.target === document.body) {
        const modal = document.getElementById('product_detail_modal');
        if (modal) {
            // Close any existing modal first
            const existingModals = document.querySelectorAll('#product_detail_modal');
            existingModals.forEach(m => {
                if (m !== modal && m.open) {
                    m.close();
                    m.remove();
                }
            });
            // Show the new modal
            modal.showModal();
            
            // Clean up on close
            modal.addEventListener('close', function() {
                const self = this;
                setTimeout(() => {
                    if (self.parentNode) {
                        self.remove();
                    }
                }, 150);
            }, { once: true });
        }
    }
});
</script>

</body>
</html>